(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const s of h)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(h){const s={};return h.integrity&&(s.integrity=h.integrity),h.referrerPolicy&&(s.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?s.credentials="include":h.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(h){if(h.ep)return;h.ep=!0;const s=t(h);fetch(h.href,s)}})();class M{constructor(e,t){this.canvas=document.getElementById(e),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.particles=[],this.imagePath=t,this.image=null,this.gap=3,this.state="IDLE_PARTICLES",this.golGrid=[],this.cols=0,this.rows=0,this.cellSize=4,this.isGolRunning=!1,this.frameCount=0,this.transitionOpacity=1,this.heartScale=1,this.heartBeatSpeed=.05,this.heartBaseScale=18,window.addEventListener("resize",()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.state==="IDLE_PARTICLES"&&this.image?this.processImageAndCreateParticles():this.state==="GOL"&&this.initGoL()}),this.canvas.addEventListener("mousedown",i=>this.handleGolInteraction(i)),this.canvas.addEventListener("mousemove",i=>{i.buttons===1&&this.handleGolInteraction(i)}),this.canvas.width=this.width,this.canvas.height=this.height}async init(){return new Promise(e=>{this.image=new Image,this.image.src=this.imagePath,this.image.onload=()=>{this.processImageAndCreateParticles(),this.animate(),e()}})}processImageAndCreateParticles(){if(!this.image)return;this.ctx.clearRect(0,0,this.width,this.height);const e=this.image.width/this.image.height;let t=Math.min(this.width,800),i=t/e;const h=(this.width-t)/2,s=(this.height-i)/2;this.imageRect={x:h,y:s,w:t,h:i},this.ctx.drawImage(this.image,h,s,t,i);const{x:a,y:r,w:o,h:f}=this.imageRect,g=this.ctx.getImageData(a,r,o,f).data;this.ctx.clearRect(0,0,this.width,this.height),this.particles=[];for(let n=0;n<f;n+=this.gap)for(let c=0;c<o;c+=this.gap){const m=(n*o+c)*4;if(g[m+3]>128){const v=g[m],G=g[m+1],I=g[m+2],y=`rgb(${v},${G},${I})`;this.particles.push({x:a+c,y:r+n,originX:a+c,originY:r+n,color:y,originColor:y,size:Math.max(1,this.gap-1),targetX:a+c,targetY:r+n,vx:0,vy:0,ease:.1,heartX:0,heartY:0,breathOffset:Math.random()*Math.PI*2})}}}shatterAndMorphToLine(){this.state="PARTICLE_ANIMATION",this.morphToLine()}morphToLine(){const e=this.particles.length,t=this.width*.8,i=(this.width-t)/2,h=t/e,s=this.height/2;this.particles.forEach((a,r)=>{a.targetX=i+r*h,a.targetY=s+Math.sin(r*.1)*20,a.ease=.05+Math.random()*.05})}morphToText(e){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.font='50px "Cinzel"',this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(e,this.width/2,this.height/2);const t=this.ctx.getImageData(0,0,this.width,this.height).data,i=[],h=3;for(let a=0;a<this.height;a+=h)for(let r=0;r<this.width;r+=h){const o=(a*this.width+r)*4;t[o+3]>128&&i.push({x:r,y:a})}[...this.particles].sort(()=>Math.random()-.5).forEach((a,r)=>{r<i.length?(a.targetX=i[r].x,a.targetY=i[r].y,a.color="white",a.ease=.1):(a.targetX=Math.random()*this.width,a.targetY=this.height+100,a.color="rgba(255,255,255,0)")})}morphToHeart(){this.state="HEART",this.heartStartFrame=this.frameCount;const e=[];this.heartBaseScale;const t=this.particles.length;for(let i=0;i<t;i++){const h=Math.random()*Math.PI*2,s=Math.sqrt(Math.random()),a=16*Math.pow(Math.sin(h),3),r=-(13*Math.cos(h)-5*Math.cos(2*h)-2*Math.cos(3*h)-Math.cos(4*h));e.push({hx:a*s,hy:r*s})}this.particles.forEach((i,h)=>{i.heartX=e[h].hx,i.heartY=e[h].hy,i.color="#ff3366",i.vx=0,i.vy=0,i.ease=.05})}updateHeart(){const e=(this.frameCount-this.heartStartFrame)*this.heartBeatSpeed,t=this.heartBaseScale*(1+.15*Math.sin(e*3)),i=this.width/2,h=this.height/2;this.particles.forEach(s=>{s.targetX=i+s.heartX*t,s.targetY=h+s.heartY*t;const a=s.targetX-s.x,r=s.targetY-s.y;s.x+=a*.1,s.y+=r*.1})}disintegrateToGoL(){this.state="TRANSITION_TO_GOL",this.transitionOpacity=1,this.initGoL()}startGameOfLife(){this.state="GOL",this.initGoL()}initGoL(){this.cols=Math.floor(this.width/this.cellSize),this.rows=Math.floor(this.height/this.cellSize),this.golGrid=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0)),this.particles.forEach(e=>{const t=Math.floor(e.x/this.cellSize),i=Math.floor(e.y/this.cellSize);t>=0&&t<this.cols&&i>=0&&i<this.rows&&(this.golGrid[t][i]=1)});for(let e=0;e<this.cols;e++)for(let t=0;t<this.rows;t++)this.golGrid[e][t]===0&&Math.random()<.35&&(this.golGrid[e][t]=1);this.isGolRunning=!0}updateGoL(){if(!this.isGolRunning)return;let e=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0));for(let t=0;t<this.cols;t++)for(let i=0;i<this.rows;i++){let h=this.golGrid[t][i],s=0;for(let a=-1;a<=1;a++)for(let r=-1;r<=1;r++){if(a===0&&r===0)continue;let o=(t+a+this.cols)%this.cols,f=(i+r+this.rows)%this.rows;s+=this.golGrid[o][f]}h===0&&s===3?e[t][i]=1:h===1&&(s<2||s>3)?e[t][i]=0:e[t][i]=h}this.golGrid=e}handleGolInteraction(e){if(this.state!=="GOL")return;const t=this.canvas.getBoundingClientRect(),i=e.clientX-t.left,h=e.clientY-t.top,s=Math.floor(i/this.cellSize),a=Math.floor(h/this.cellSize);s>=0&&s<this.cols&&a>=0&&a<this.rows&&(this.golGrid[s][a]=1,s+1<this.cols&&(this.golGrid[s+1][a]=1),a+1<this.rows&&(this.golGrid[s][a+1]=1))}drawGoL(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#ff3366";for(let e=0;e<this.cols;e++)for(let t=0;t<this.rows;t++)this.golGrid[e][t]===1&&this.ctx.fillRect(e*this.cellSize,t*this.cellSize,this.cellSize-1,this.cellSize-1)}updateIdle(){const e=this.frameCount*.02;this.particles.forEach(t=>{const i=Math.sin(e+t.breathOffset)*2,h=Math.cos(e+t.breathOffset*.5)*2;t.x=t.originX+i,t.y=t.originY+h,t.vx=0,t.vy=0})}update(){this.particles.forEach(e=>{const t=e.targetX-e.x,i=e.targetY-e.y;e.vx=t*e.ease,e.vy=i*e.ease,e.x+=e.vx,e.y+=e.vy})}draw(e=!1){this.ctx.clearRect(0,0,this.width,this.height),this.particles.forEach(t=>{this.ctx.fillStyle=t.color,this.ctx.fillRect(t.x,t.y,t.size,t.size)})}animate(){this.frameCount++,this.state==="IDLE_PARTICLES"?(this.updateIdle(),this.draw(!0)):this.state==="HEART"?(this.updateHeart(),this.draw()):this.state==="GOL"?(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.update(),this.draw()):this.state==="TRANSITION_TO_GOL"&&(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.ctx.save(),this.ctx.globalAlpha=this.transitionOpacity,this.updateHeart(),this.draw(!1),this.ctx.restore(),this.transitionOpacity-=.015,this.transitionOpacity<=0&&(this.state="GOL",this.transitionOpacity=0)),requestAnimationFrame(()=>this.animate())}}const T="/proposal-site-escher/escher.png";document.querySelector("#app").innerHTML=`
  <canvas id="canvas"></canvas>
  <div id="start-prompt" class="fade-in">
    <p>Click Anywhere to Begin</p>
  </div>
  
  <div id="ui-layer" class="hidden">
    <div id="input-container">
      <input type="text" id="answer-input" placeholder="Type your answer..." autocomplete="off" />
      <p id="error-message" class="error-text">Please contact the site admin, who took a lot of time to make this, with any queries or concerns.</p>
    </div>
  </div>

  <div id="success-layer" class="hidden">
    <!-- Success text updated per user request -->
    <h1 class="fade-in-slow">we have progressed to the next level</h1>
  </div>
`;const d=new M("canvas",T);d.init();let x=!1;const p=document.getElementById("start-prompt"),w=document.getElementById("ui-layer"),l=document.getElementById("answer-input"),L=document.getElementById("error-message"),S=document.getElementById("success-layer");document.addEventListener("click",()=>{x||(x=!0,p.style.opacity=0,setTimeout(()=>p.remove(),1e3),d.shatterAndMorphToLine(),setTimeout(()=>{d.morphToText("Will you be my girlfriend?"),setTimeout(()=>{w.classList.remove("hidden"),w.classList.add("active"),l.focus()},2500)},2e3))});l.addEventListener("keydown",u=>{if(u.key==="Enter"){const e=l.value.trim().toLowerCase();["yes","yeah","yep","ok","okay","sure","definitely","absolutely","of course"].some(i=>e.includes(i))?(w.classList.add("hidden"),d.morphToHeart(),setTimeout(()=>{d.disintegrateToGoL(),setTimeout(()=>{S.classList.remove("hidden")},500)},4e3)):(L.classList.add("show"),l.classList.add("shake"),setTimeout(()=>{l.classList.remove("shake"),L.classList.remove("show")},5e3))}});
