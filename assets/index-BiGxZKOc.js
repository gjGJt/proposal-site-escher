(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const h of s)if(h.type==="childList")for(const r of h.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const h={};return s.integrity&&(h.integrity=s.integrity),s.referrerPolicy&&(h.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?h.credentials="include":s.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(s){if(s.ep)return;s.ep=!0;const h=e(s);fetch(s.href,h)}})();class I{constructor(t,e){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.particles=[],this.imagePath=e,this.image=null,this.gap=3,this.state="IDLE_PARTICLES",this.golGrid=[],this.cols=0,this.rows=0,this.cellSize=4,this.isGolRunning=!1,this.frameCount=0,this.transitionOpacity=1,this.heartScale=1,this.heartBeatSpeed=.05,this.heartBaseScale=18,window.addEventListener("resize",()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.state==="IDLE_PARTICLES"&&this.image?this.processImageAndCreateParticles():(this.state==="GOL"||this.state==="TRANSITION_TO_GOL")&&this.initGoL()}),this.canvas.addEventListener("mousedown",i=>this.handleGolInteraction(i)),this.canvas.addEventListener("mousemove",i=>{i.buttons===1&&this.handleGolInteraction(i)}),this.canvas.width=this.width,this.canvas.height=this.height}async init(){return new Promise(t=>{this.image=new Image,this.image.src=this.imagePath,this.image.onload=()=>{this.processImageAndCreateParticles(),this.animate(),t()}})}processImageAndCreateParticles(){if(!this.image)return;this.ctx.clearRect(0,0,this.width,this.height);const t=this.image.width/this.image.height;let e=Math.min(this.width,800),i=e/t;const s=(this.width-e)/2,h=(this.height-i)/2;this.imageRect={x:s,y:h,w:e,h:i},this.ctx.drawImage(this.image,s,h,e,i);const{x:r,y:a,w:o,h:n}=this.imageRect,d=this.ctx.getImageData(r,a,o,n).data;this.ctx.clearRect(0,0,this.width,this.height),this.particles=[];for(let c=0;c<n;c+=this.gap)for(let l=0;l<o;l+=this.gap){const g=(c*o+l)*4;if(d[g+3]>128){const f=d[g],u=d[g+1],x=d[g+2],L=`rgb(${f},${u},${x})`;this.particles.push({x:r+l,y:a+c,originX:r+l,originY:a+c,color:L,originColor:L,size:Math.max(1,this.gap-1),targetX:r+l,targetY:a+c,vx:0,vy:0,ease:.1,heartX:0,heartY:0,r:f,g:u,b:x,tr:f,tg:u,tb:x,colorLerpSpeed:.05,originalSize:Math.max(1,this.gap-1),currentSize:Math.max(1,this.gap-1),sizeTarget:Math.max(1,this.gap-1),morphStartFrame:0,burstX:0,burstY:0,breathOffset:Math.random()*Math.PI*2})}}}shatterAndMorphToLine(){this.state="PARTICLE_ANIMATION",this.morphToLine()}morphToLine(){const t=this.particles.length,e=this.width*.8,i=(this.width-e)/2,s=e/t,h=this.height/2;this.particles.forEach((r,a)=>{r.targetX=i+a*s,r.targetY=h+Math.sin(a*.1)*20,r.ease=.05+Math.random()*.05})}morphToText(t){this.state="PARTICLE_ANIMATION",this.ctx.clearRect(0,0,this.width,this.height);let e=50;for(this.ctx.font=`${e}px "Cinzel"`;this.ctx.measureText(t).width>this.width*.9&&e>10;)e-=2,this.ctx.font=`${e}px "Cinzel"`;this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t,this.width/2,this.height/2);const i=this.ctx.getImageData(0,0,this.width,this.height).data,s=[],h=3;for(let a=0;a<this.height;a+=h)for(let o=0;o<this.width;o+=h){const n=(a*this.width+o)*4;i[n+3]>128&&s.push({x:o,y:a})}[...this.particles].sort(()=>Math.random()-.5).forEach((a,o)=>{o<s.length?(a.targetX=s[o].x,a.targetY=s[o].y,a.tr=255,a.tg=255,a.tb=255,a.ease=.035,a.sizeTarget=a.originalSize):(a.targetX=Math.random()*this.width,a.targetY=this.height+100,a.tr=0,a.tg=0,a.tb=0,a.sizeTarget=0)})}morphToHeart(){this.state="HEART",this.heartStartFrame=this.frameCount;const t=[];this.heartBaseScale;const e=this.particles.length;for(let i=0;i<e;i++){const s=Math.random()*Math.PI*2,h=Math.sqrt(Math.random()),r=16*Math.pow(Math.sin(s),3),a=-(13*Math.cos(s)-5*Math.cos(2*s)-2*Math.cos(3*s)-Math.cos(4*s));t.push({hx:r*h,hy:a*h})}this.particles.forEach((i,s)=>{i.heartX=t[s].hx,i.heartY=t[s].hy,i.tr=255,i.tg=51,i.tb=102,i.vx=(Math.random()-.5)*15,i.vy=(Math.random()-.5)*15,i.ease=.04,i.morphStartFrame=this.frameCount,i.sizeTarget=i.originalSize})}updateHeart(){const t=(this.frameCount-this.heartStartFrame)*this.heartBeatSpeed,e=this.heartBaseScale*(1+.15*Math.sin(t*3)),i=this.width/2,s=this.height/2;this.particles.forEach(h=>{h.targetX=i+h.heartX*e,h.targetY=s+h.heartY*e;const r=h.targetX-h.x,a=h.targetY-h.y;h.x+=r*.1,h.y+=a*.1})}disintegrateToGoL(){this.state="TRANSITION_TO_GOL",this.transitionOpacity=1,this.initGoL()}startGameOfLife(){this.state="GOL",this.initGoL()}initGoL(){this.cols=Math.floor(this.width/this.cellSize),this.rows=Math.floor(this.height/this.cellSize),this.golGrid=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0)),this.particles.forEach(t=>{const e=Math.floor(t.x/this.cellSize),i=Math.floor(t.y/this.cellSize);e>=0&&e<this.cols&&i>=0&&i<this.rows&&(this.golGrid[e][i]=1)});for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.golGrid[t][e]===0&&Math.random()<.4&&(this.golGrid[t][e]=1);this.isGolRunning=!0}updateGoL(){if(!this.isGolRunning)return;let t=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0));for(let e=0;e<this.cols;e++)for(let i=0;i<this.rows;i++){let s=this.golGrid[e][i],h=0;for(let r=-1;r<=1;r++)for(let a=-1;a<=1;a++){if(r===0&&a===0)continue;let o=(e+r+this.cols)%this.cols,n=(i+a+this.rows)%this.rows;h+=this.golGrid[o][n]}s===0&&h===3?t[e][i]=1:s===1&&(h<2||h>3)?t[e][i]=0:t[e][i]=s,t[e][i]===0&&Math.random()<5e-4&&(t[e][i]=1)}this.golGrid=t}handleGolInteraction(t){if(this.state!=="GOL")return;const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,h=Math.floor(i/this.cellSize),r=Math.floor(s/this.cellSize);h>=0&&h<this.cols&&r>=0&&r<this.rows&&(this.golGrid[h][r]=1,h+1<this.cols&&(this.golGrid[h+1][r]=1),r+1<this.rows&&(this.golGrid[h][r+1]=1))}drawGoL(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#ff3366";for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.golGrid[t][e]===1&&this.ctx.fillRect(t*this.cellSize,e*this.cellSize,this.cellSize-1,this.cellSize-1)}updateIdle(){const t=this.frameCount*.02;this.particles.forEach(e=>{const i=Math.sin(t+e.breathOffset)*2,s=Math.cos(t+e.breathOffset*.5)*2;e.x=e.originX+i,e.y=e.originY+s,e.vx=0,e.vy=0})}update(){this.particles.forEach(t=>{const e=this.frameCount-t.morphStartFrame,s=Math.min(1,e/100),h=Math.max(0,1-e/30),r=t.burstX*h,a=t.burstY*h,o=Math.sin(s*Math.PI)*1.8,n=s*Math.PI*2.5,d=Math.cos(n)*o,c=Math.sin(n)*o,l=t.targetX-t.x,g=t.targetY-t.y,f=Math.sin(this.frameCount*.1+t.breathOffset)*.15;t.vx=l*t.ease+r+d+f,t.vy=g*t.ease+a+c+f,t.x+=t.vx,t.y+=t.vy,t.r+=(t.tr-t.r)*.06,t.g+=(t.tg-t.g)*.06,t.b+=(t.tb-t.b)*.06,t.color=`rgb(${Math.round(t.r)},${Math.round(t.g)},${Math.round(t.b)})`;const u=Math.sin(s*Math.PI)*2.2;t.currentSize=t.sizeTarget+u})}draw(t=!1,e=!0){e&&(this.state==="PARTICLE_ANIMATION"||this.state==="HEART"?(this.ctx.fillStyle="rgba(10, 10, 10, 0.4)",this.ctx.fillRect(0,0,this.width,this.height)):this.ctx.clearRect(0,0,this.width,this.height)),this.particles.forEach(i=>{this.ctx.fillStyle=i.color,this.ctx.fillRect(i.x,i.y,i.currentSize,i.currentSize)})}animate(){this.frameCount++,this.state==="IDLE_PARTICLES"?(this.updateIdle(),this.draw(!0)):this.state==="HEART"?(this.updateHeart(),this.draw()):this.state==="GOL"?(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.update(),this.draw()):this.state==="TRANSITION_TO_GOL"&&(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.ctx.save(),this.ctx.globalAlpha=this.transitionOpacity,this.updateHeart(),this.draw(!1,!1),this.ctx.restore(),this.transitionOpacity>.25?this.transitionOpacity-=.015:this.transitionOpacity=.25),requestAnimationFrame(()=>this.animate())}}const p="/proposal-site-escher/escher.png";document.querySelector("#app").innerHTML=`
  <canvas id="canvas"></canvas>
  <div id="start-prompt" class="fade-in">
    <p>Loading...</p>
  </div>
  
  <div id="ui-layer" class="hidden">
    <div id="input-container">
      <input type="text" id="answer-input" placeholder="Type your answer..." autocomplete="off" />
      <p id="error-message" class="error-text">Please contact the site admin, who took a lot of time to make this, with any queries or concerns.</p>
    </div>
  </div>

  <div id="success-layer" class="hidden">
    <!-- Success text updated per user request -->
    <h1 class="fade-in-slow">we have progressed to the next level</h1>
  </div>
`;const y=new I("canvas",p);try{await y.init()}catch(m){console.error("Failed to load assets",m)}let T=!1;const M=document.getElementById("start-prompt"),v=document.getElementById("ui-layer"),w=document.getElementById("answer-input"),S=document.getElementById("error-message");document.getElementById("success-layer");M.querySelector("p").innerText="Click Anywhere to Begin";document.addEventListener("click",()=>{T||(T=!0,M.style.opacity=0,setTimeout(()=>M.remove(),1e3),y.morphToText("Will you be my girlfriend?"),setTimeout(()=>{v.classList.remove("hidden"),v.classList.add("active"),w.focus()},4e3))});w.addEventListener("keydown",m=>{if(m.key==="Enter"){const t=w.value.trim().toLowerCase();["yes","yeah","yep","ok","okay","sure","definitely","absolutely","of course"].some(i=>t.includes(i))?(v.classList.add("hidden"),y.morphToText("We have progressed to the next level"),setTimeout(()=>{y.morphToHeart(),setTimeout(()=>{y.disintegrateToGoL()},4e3)},3e3)):(S.classList.add("show"),w.classList.add("shake"),setTimeout(()=>{w.classList.remove("shake"),S.classList.remove("show")},5e3))}});
