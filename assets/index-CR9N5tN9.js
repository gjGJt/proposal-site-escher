(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();class T{constructor(t,e){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.particles=[],this.imagePath=e,this.image=null,this.gap=3,this.state="IDLE_PARTICLES",this.golGrid=[],this.cols=0,this.rows=0,this.cellSize=4,this.isGolRunning=!1,this.frameCount=0,this.transitionOpacity=1,this.heartScale=1,this.heartBeatSpeed=.05,this.heartBaseScale=18,window.addEventListener("resize",()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.state==="IDLE_PARTICLES"&&this.image?this.processImageAndCreateParticles():(this.state==="GOL"||this.state==="TRANSITION_TO_GOL")&&this.initGoL()}),this.canvas.addEventListener("mousedown",i=>this.handleGolInteraction(i)),this.canvas.addEventListener("mousemove",i=>{i.buttons===1&&this.handleGolInteraction(i)}),this.canvas.width=this.width,this.canvas.height=this.height}async init(){return new Promise(t=>{this.image=new Image,this.image.src=this.imagePath,this.image.onload=()=>{this.processImageAndCreateParticles(),this.animate(),t()}})}processImageAndCreateParticles(){if(!this.image)return;this.ctx.clearRect(0,0,this.width,this.height);const t=this.image.width/this.image.height;let e=Math.min(this.width,800),i=e/t;const s=(this.width-e)/2,a=(this.height-i)/2;this.imageRect={x:s,y:a,w:e,h:i},this.ctx.drawImage(this.image,s,a,e,i);const{x:r,y:h,w:o,h:n}=this.imageRect,d=this.ctx.getImageData(r,h,o,n).data;this.ctx.clearRect(0,0,this.width,this.height),this.particles=[];for(let c=0;c<n;c+=this.gap)for(let l=0;l<o;l+=this.gap){const f=(c*o+l)*4;if(d[f+3]>128){const w=d[f],v=d[f+1],S=d[f+2],M=`rgb(${w},${v},${S})`;this.particles.push({x:r+l,y:h+c,originX:r+l,originY:h+c,color:M,originColor:M,size:Math.max(1,this.gap-1),targetX:r+l,targetY:h+c,vx:0,vy:0,ease:.1,heartX:0,heartY:0,originalSize:Math.max(1,this.gap-1),currentSize:Math.max(1,this.gap-1),sizeTarget:Math.max(1,this.gap-1),morphStartFrame:0,burstX:0,burstY:0,breathOffset:Math.random()*Math.PI*2})}}}shatterAndMorphToLine(){this.state="PARTICLE_ANIMATION",this.morphToLine()}morphToLine(){const t=this.particles.length,e=this.width*.8,i=(this.width-e)/2,s=e/t,a=this.height/2;this.particles.forEach((r,h)=>{r.targetX=i+h*s,r.targetY=a+Math.sin(h*.1)*20,r.ease=.05+Math.random()*.05,r.morphStartFrame=this.frameCount,r.burstX=(Math.random()-.5)*20,r.burstY=(Math.random()-.5)*20})}morphToText(t){this.state="PARTICLE_ANIMATION",this.ctx.clearRect(0,0,this.width,this.height);let e=50;for(this.ctx.font=`${e}px "Cinzel"`;this.ctx.measureText(t).width>this.width*.9&&e>10;)e-=2,this.ctx.font=`${e}px "Cinzel"`;this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t,this.width/2,this.height/2);const i=this.ctx.getImageData(0,0,this.width,this.height).data,s=[],a=3;for(let h=0;h<this.height;h+=a)for(let o=0;o<this.width;o+=a){const n=(h*this.width+o)*4;i[n+3]>128&&s.push({x:o,y:h})}[...this.particles].sort(()=>Math.random()-.5).forEach((h,o)=>{h.morphStartFrame=this.frameCount,h.burstX=(Math.random()-.5)*30,h.burstY=(Math.random()-.5)*30,o<s.length?(h.targetX=s[o].x,h.targetY=s[o].y,h.color="white",h.ease=.035,h.sizeTarget=h.originalSize):(h.targetX=Math.random()*this.width,h.targetY=this.height+100,h.color="rgba(255,255,255,0)",h.sizeTarget=0)})}morphToHeart(){this.state="HEART",this.heartStartFrame=this.frameCount;const t=[];this.heartBaseScale;const e=this.particles.length;for(let i=0;i<e;i++){const s=Math.random()*Math.PI*2,a=Math.sqrt(Math.random()),r=16*Math.pow(Math.sin(s),3),h=-(13*Math.cos(s)-5*Math.cos(2*s)-2*Math.cos(3*s)-Math.cos(4*s));t.push({hx:r*a,hy:h*a})}this.particles.forEach((i,s)=>{i.heartX=t[s].hx,i.heartY=t[s].hy,i.color="#ff3366",i.vx=(Math.random()-.5)*15,i.vy=(Math.random()-.5)*15,i.ease=.04,i.morphStartFrame=this.frameCount,i.sizeTarget=i.originalSize})}updateHeart(){const t=(this.frameCount-this.heartStartFrame)*this.heartBeatSpeed,e=this.heartBaseScale*(1+.15*Math.sin(t*3)),i=this.width/2,s=this.height/2;this.particles.forEach(a=>{a.targetX=i+a.heartX*e,a.targetY=s+a.heartY*e;const r=a.targetX-a.x,h=a.targetY-a.y;a.x+=r*.1,a.y+=h*.1})}disintegrateToGoL(){this.state="TRANSITION_TO_GOL",this.transitionOpacity=1,this.initGoL()}startGameOfLife(){this.state="GOL",this.initGoL()}initGoL(){this.cols=Math.floor(this.width/this.cellSize),this.rows=Math.floor(this.height/this.cellSize),this.golGrid=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0)),this.particles.forEach(t=>{const e=Math.floor(t.x/this.cellSize),i=Math.floor(t.y/this.cellSize);e>=0&&e<this.cols&&i>=0&&i<this.rows&&(this.golGrid[e][i]=1)});for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.golGrid[t][e]===0&&Math.random()<.4&&(this.golGrid[t][e]=1);this.isGolRunning=!0}updateGoL(){if(!this.isGolRunning)return;let t=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0));for(let e=0;e<this.cols;e++)for(let i=0;i<this.rows;i++){let s=this.golGrid[e][i],a=0;for(let r=-1;r<=1;r++)for(let h=-1;h<=1;h++){if(r===0&&h===0)continue;let o=(e+r+this.cols)%this.cols,n=(i+h+this.rows)%this.rows;a+=this.golGrid[o][n]}s===0&&a===3?t[e][i]=1:s===1&&(a<2||a>3)?t[e][i]=0:t[e][i]=s,t[e][i]===0&&Math.random()<5e-4&&(t[e][i]=1)}this.golGrid=t}handleGolInteraction(t){if(this.state!=="GOL")return;const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,s=t.clientY-e.top,a=Math.floor(i/this.cellSize),r=Math.floor(s/this.cellSize);a>=0&&a<this.cols&&r>=0&&r<this.rows&&(this.golGrid[a][r]=1,a+1<this.cols&&(this.golGrid[a+1][r]=1),r+1<this.rows&&(this.golGrid[a][r+1]=1))}drawGoL(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#ff3366";for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.golGrid[t][e]===1&&this.ctx.fillRect(t*this.cellSize,e*this.cellSize,this.cellSize-1,this.cellSize-1)}updateIdle(){const t=this.frameCount*.02;this.particles.forEach(e=>{const i=Math.sin(t+e.breathOffset)*2,s=Math.cos(t+e.breathOffset*.5)*2;e.x=e.originX+i,e.y=e.originY+s,e.vx=0,e.vy=0})}update(){this.particles.forEach(t=>{const e=this.frameCount-t.morphStartFrame,i=100,s=Math.max(0,1-e/20),a=t.burstX*s,r=t.burstY*s,h=Math.min(1,e/i),o=Math.sin(h*Math.PI)*1.5,n=h*Math.PI*2,d=Math.cos(n)*o,c=Math.sin(n)*o,l=t.targetX-t.x,f=t.targetY-t.y;t.vx=l*t.ease+a+d,t.vy=f*t.ease+r+c,t.x+=t.vx,t.y+=t.vy;const w=Math.sin(h*Math.PI)*2;t.currentSize=t.sizeTarget+w})}draw(t=!1,e=!0){e&&this.ctx.clearRect(0,0,this.width,this.height),this.particles.forEach(i=>{this.ctx.fillStyle=i.color,this.ctx.fillRect(i.x,i.y,i.currentSize,i.currentSize)})}animate(){this.frameCount++,this.state==="IDLE_PARTICLES"?(this.updateIdle(),this.draw(!0)):this.state==="HEART"?(this.updateHeart(),this.draw()):this.state==="GOL"?(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.update(),this.draw()):this.state==="TRANSITION_TO_GOL"&&(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.ctx.save(),this.ctx.globalAlpha=this.transitionOpacity,this.updateHeart(),this.draw(!1,!1),this.ctx.restore(),this.transitionOpacity>.25?this.transitionOpacity-=.015:this.transitionOpacity=.25),requestAnimationFrame(()=>this.animate())}}const I="/proposal-site-escher/escher.png";document.querySelector("#app").innerHTML=`
  <canvas id="canvas"></canvas>
  <div id="start-prompt" class="fade-in">
    <p>Loading...</p>
  </div>
  
  <div id="ui-layer" class="hidden">
    <div id="input-container">
      <input type="text" id="answer-input" placeholder="Type your answer..." autocomplete="off" />
      <p id="error-message" class="error-text">Please contact the site admin, who took a lot of time to make this, with any queries or concerns.</p>
    </div>
  </div>

  <div id="success-layer" class="hidden"></div>
`;const u=new T("canvas",I);try{await u.init()}catch(m){console.error("Failed to load assets",m)}let L=!1;const y=document.getElementById("start-prompt"),x=document.getElementById("ui-layer"),g=document.getElementById("answer-input"),p=document.getElementById("error-message");document.getElementById("success-layer");y.querySelector("p").innerText="Click Anywhere to Begin";document.addEventListener("click",()=>{L||(L=!0,y.style.opacity=0,setTimeout(()=>y.remove(),1e3),u.morphToText("Will you be my girlfriend?"),setTimeout(()=>{x.classList.remove("hidden"),x.classList.add("active"),g.focus()},5e3))});g.addEventListener("keydown",m=>{if(m.key==="Enter"){const t=g.value.trim().toLowerCase();["yes","yeah","yep","ok","okay","sure","definitely","absolutely","of course"].some(i=>t.includes(i))?(x.classList.add("hidden"),u.morphToText("We have progressed to the next level"),setTimeout(()=>{u.morphToHeart(),setTimeout(()=>{u.disintegrateToGoL()},4e3)},3e3)):(p.classList.add("show"),g.classList.add("shake"),setTimeout(()=>{g.classList.remove("shake"),p.classList.remove("show")},5e3))}});
