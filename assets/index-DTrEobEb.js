(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))i(h);new MutationObserver(h=>{for(const s of h)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(h){const s={};return h.integrity&&(s.integrity=h.integrity),h.referrerPolicy&&(s.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?s.credentials="include":h.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(h){if(h.ep)return;h.ep=!0;const s=e(h);fetch(h.href,s)}})();class I{constructor(t,e){this.canvas=document.getElementById(t),this.ctx=this.canvas.getContext("2d"),this.width=window.innerWidth,this.height=window.innerHeight,this.particles=[],this.imagePath=e,this.image=null,this.gap=3,this.state="IDLE_PARTICLES",this.golGrid=[],this.cols=0,this.rows=0,this.cellSize=4,this.isGolRunning=!1,this.frameCount=0,this.transitionOpacity=1,this.heartScale=1,this.heartBeatSpeed=.05,this.heartBaseScale=18,window.addEventListener("resize",()=>{this.width=window.innerWidth,this.height=window.innerHeight,this.canvas.width=this.width,this.canvas.height=this.height,this.state==="IDLE_PARTICLES"&&this.image?this.processImageAndCreateParticles():(this.state==="GOL"||this.state==="TRANSITION_TO_GOL")&&this.initGoL()}),this.canvas.addEventListener("mousedown",i=>this.handleGolInteraction(i)),this.canvas.addEventListener("mousemove",i=>{i.buttons===1&&this.handleGolInteraction(i)}),this.canvas.width=this.width,this.canvas.height=this.height}async init(){return new Promise(t=>{this.image=new Image,this.image.src=this.imagePath,this.image.onload=()=>{this.processImageAndCreateParticles(),this.animate(),t()}})}processImageAndCreateParticles(){if(!this.image)return;this.ctx.clearRect(0,0,this.width,this.height);const t=this.image.width/this.image.height;let e=Math.min(this.width,800),i=e/t;const h=(this.width-e)/2,s=(this.height-i)/2;this.imageRect={x:h,y:s,w:e,h:i},this.ctx.drawImage(this.image,h,s,e,i);const{x:a,y:r,w:o,h:n}=this.imageRect,m=this.ctx.getImageData(a,r,o,n).data;this.ctx.clearRect(0,0,this.width,this.height),this.particles=[];for(let c=0;c<n;c+=this.gap)for(let l=0;l<o;l+=this.gap){const u=(c*o+l)*4;if(m[u+3]>128){const v=m[u],T=m[u+1],G=m[u+2],x=`rgb(${v},${T},${G})`;this.particles.push({x:a+l,y:r+c,originX:a+l,originY:r+c,color:x,originColor:x,size:Math.max(1,this.gap-1),targetX:a+l,targetY:r+c,vx:0,vy:0,ease:.1,heartX:0,heartY:0,breathOffset:Math.random()*Math.PI*2})}}}shatterAndMorphToLine(){this.state="PARTICLE_ANIMATION",this.morphToLine()}morphToLine(){const t=this.particles.length,e=this.width*.8,i=(this.width-e)/2,h=e/t,s=this.height/2;this.particles.forEach((a,r)=>{a.targetX=i+r*h,a.targetY=s+Math.sin(r*.1)*20,a.ease=.05+Math.random()*.05})}morphToText(t){this.state="PARTICLE_ANIMATION",this.ctx.clearRect(0,0,this.width,this.height);let e=50;for(this.ctx.font=`${e}px "Cinzel"`;this.ctx.measureText(t).width>this.width*.9&&e>10;)e-=2,this.ctx.font=`${e}px "Cinzel"`;this.ctx.fillStyle="white",this.ctx.textAlign="center",this.ctx.textBaseline="middle",this.ctx.fillText(t,this.width/2,this.height/2);const i=this.ctx.getImageData(0,0,this.width,this.height).data,h=[],s=3;for(let r=0;r<this.height;r+=s)for(let o=0;o<this.width;o+=s){const n=(r*this.width+o)*4;i[n+3]>128&&h.push({x:o,y:r})}[...this.particles].sort(()=>Math.random()-.5).forEach((r,o)=>{o<h.length?(r.targetX=h[o].x,r.targetY=h[o].y,r.color="white",r.ease=.04):(r.targetX=Math.random()*this.width,r.targetY=this.height+100,r.color="rgba(255,255,255,0)")})}morphToHeart(){this.state="HEART",this.heartStartFrame=this.frameCount;const t=[];this.heartBaseScale;const e=this.particles.length;for(let i=0;i<e;i++){const h=Math.random()*Math.PI*2,s=Math.sqrt(Math.random()),a=16*Math.pow(Math.sin(h),3),r=-(13*Math.cos(h)-5*Math.cos(2*h)-2*Math.cos(3*h)-Math.cos(4*h));t.push({hx:a*s,hy:r*s})}this.particles.forEach((i,h)=>{i.heartX=t[h].hx,i.heartY=t[h].hy,i.color="#ff3366",i.vx=0,i.vy=0,i.ease=.05})}updateHeart(){const t=(this.frameCount-this.heartStartFrame)*this.heartBeatSpeed,e=this.heartBaseScale*(1+.15*Math.sin(t*3)),i=this.width/2,h=this.height/2;this.particles.forEach(s=>{s.targetX=i+s.heartX*e,s.targetY=h+s.heartY*e;const a=s.targetX-s.x,r=s.targetY-s.y;s.x+=a*.1,s.y+=r*.1})}disintegrateToGoL(){this.state="TRANSITION_TO_GOL",this.transitionOpacity=1,this.initGoL()}startGameOfLife(){this.state="GOL",this.initGoL()}initGoL(){this.cols=Math.floor(this.width/this.cellSize),this.rows=Math.floor(this.height/this.cellSize),this.golGrid=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0)),this.particles.forEach(t=>{const e=Math.floor(t.x/this.cellSize),i=Math.floor(t.y/this.cellSize);e>=0&&e<this.cols&&i>=0&&i<this.rows&&(this.golGrid[e][i]=1)});for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.golGrid[t][e]===0&&Math.random()<.4&&(this.golGrid[t][e]=1);this.isGolRunning=!0}updateGoL(){if(!this.isGolRunning)return;let t=new Array(this.cols).fill(null).map(()=>new Array(this.rows).fill(0));for(let e=0;e<this.cols;e++)for(let i=0;i<this.rows;i++){let h=this.golGrid[e][i],s=0;for(let a=-1;a<=1;a++)for(let r=-1;r<=1;r++){if(a===0&&r===0)continue;let o=(e+a+this.cols)%this.cols,n=(i+r+this.rows)%this.rows;s+=this.golGrid[o][n]}h===0&&s===3?t[e][i]=1:h===1&&(s<2||s>3)?t[e][i]=0:t[e][i]=h,t[e][i]===0&&Math.random()<5e-4&&(t[e][i]=1)}this.golGrid=t}handleGolInteraction(t){if(this.state!=="GOL")return;const e=this.canvas.getBoundingClientRect(),i=t.clientX-e.left,h=t.clientY-e.top,s=Math.floor(i/this.cellSize),a=Math.floor(h/this.cellSize);s>=0&&s<this.cols&&a>=0&&a<this.rows&&(this.golGrid[s][a]=1,s+1<this.cols&&(this.golGrid[s+1][a]=1),a+1<this.rows&&(this.golGrid[s][a+1]=1))}drawGoL(){this.ctx.clearRect(0,0,this.width,this.height),this.ctx.fillStyle="#ff3366";for(let t=0;t<this.cols;t++)for(let e=0;e<this.rows;e++)this.golGrid[t][e]===1&&this.ctx.fillRect(t*this.cellSize,e*this.cellSize,this.cellSize-1,this.cellSize-1)}updateIdle(){const t=this.frameCount*.02;this.particles.forEach(e=>{const i=Math.sin(t+e.breathOffset)*2,h=Math.cos(t+e.breathOffset*.5)*2;e.x=e.originX+i,e.y=e.originY+h,e.vx=0,e.vy=0})}update(){this.particles.forEach(t=>{const e=t.targetX-t.x,i=t.targetY-t.y;t.vx=e*t.ease,t.vy=i*t.ease,t.x+=t.vx,t.y+=t.vy})}draw(t=!1,e=!0){e&&this.ctx.clearRect(0,0,this.width,this.height),this.particles.forEach(i=>{this.ctx.fillStyle=i.color,this.ctx.fillRect(i.x,i.y,i.size,i.size)})}animate(){this.frameCount++,this.state==="IDLE_PARTICLES"?(this.updateIdle(),this.draw(!0)):this.state==="HEART"?(this.updateHeart(),this.draw()):this.state==="GOL"?(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.update(),this.draw()):this.state==="TRANSITION_TO_GOL"&&(this.frameCount%10===0&&this.updateGoL(),this.drawGoL(),this.ctx.save(),this.ctx.globalAlpha=this.transitionOpacity,this.updateHeart(),this.draw(!1,!1),this.ctx.restore(),this.transitionOpacity>.25?this.transitionOpacity-=.015:this.transitionOpacity=.25),requestAnimationFrame(()=>this.animate())}}const M="/proposal-site-escher/escher.png";document.querySelector("#app").innerHTML=`
  <canvas id="canvas"></canvas>
  <div id="start-prompt" class="fade-in">
    <p>Loading...</p>
  </div>
  
  <div id="ui-layer" class="hidden">
    <div id="input-container">
      <input type="text" id="answer-input" placeholder="Type your answer..." autocomplete="off" />
      <p id="error-message" class="error-text">Please contact the site admin, who took a lot of time to make this, with any queries or concerns.</p>
    </div>
  </div>

  <div id="success-layer" class="hidden"></div>
`;const g=new I("canvas",M);try{await g.init()}catch(d){console.error("Failed to load assets",d)}let p=!1;const w=document.getElementById("start-prompt"),y=document.getElementById("ui-layer"),f=document.getElementById("answer-input"),L=document.getElementById("error-message");document.getElementById("success-layer");w.querySelector("p").innerText="Click Anywhere to Begin";document.addEventListener("click",()=>{p||(p=!0,w.style.opacity=0,setTimeout(()=>w.remove(),1e3),g.morphToText("Will you be my girlfriend?"),setTimeout(()=>{y.classList.remove("hidden"),y.classList.add("active"),f.focus()},4e3))});f.addEventListener("keydown",d=>{if(d.key==="Enter"){const t=f.value.trim().toLowerCase();["yes","yeah","yep","ok","okay","sure","definitely","absolutely","of course"].some(i=>t.includes(i))?(y.classList.add("hidden"),g.morphToText("We have progressed to the next level"),setTimeout(()=>{g.morphToHeart(),setTimeout(()=>{g.disintegrateToGoL()},4e3)},3e3)):(L.classList.add("show"),f.classList.add("shake"),setTimeout(()=>{f.classList.remove("shake"),L.classList.remove("show")},5e3))}});
